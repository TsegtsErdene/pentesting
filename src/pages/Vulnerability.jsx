import { useState } from 'react'
import axios from 'axios'

export default function Vulnerability() {
    const [url, setUrl] = useState('')
    const [response, setResponse] = useState(null)

    const handleSubmit = async (e) => {
        e.preventDefault()
        const urlEncoded = encodeURIComponent(url)
        const apiKey = '6284da3bb3ec2207d4dec7974e9a4deb7be5ab533937af9eb9a411052ff7dae8' // Replace with your API key

        const urlReportEndpoint = `https://www.virustotal.com/vtapi/v2/url/report?apikey=${apiKey}&resource=${urlEncoded}`
        const { data } = await axios.get(urlReportEndpoint)

        setResponse(data)
    }

    return (
        <div className="container mx-auto">
            <form onSubmit={handleSubmit}>
                <label htmlFor="url-input" className="block font-bold mb-2">
                    Enter URL:
                </label>
                <input
                    type="text"
                    id="url-input"
                    value={url}
                    onChange={(e) => setUrl(e.target.value)}
                    className="border border-gray-400 px-4 py-2 w-full"
                />
                <button
                    type="submit"
                    className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 mt-4 rounded"
                >
                    Submit
                </button>
            </form>
            {response && (
                <div className="mt-4">
                    <p className="font-bold">Scan results:</p>
                    <ul className="list-disc ml-4">
                        {response.scans.map((scan) => (
                            <li
                                key={scan.name}
                                className={`${scan.detected ? 'text-red-500' : 'text-green-500'} ${
                                    scan.detected ? 'font-bold' : ''
                                }`}
                            >
                                {scan.name}: {scan.result}
                            </li>
                        ))}
                    </ul>
                </div>
            )}
        </div>
    )
}
